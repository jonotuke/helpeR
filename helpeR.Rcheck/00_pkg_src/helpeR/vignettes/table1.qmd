---
title: "Using table1"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Using table1}
  %\VignetteEngine{quarto::html}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(helpeR)
pacman::p_load(conflicted, table1, palmerpenguins, tidyverse)
```

Based on 

- <https://blog.djnavarro.net/posts/2024-06-21_table1/>

# Data
```{r}
penguins |> glimpse()
```

# Basic table
The basic command gives a simple table - @tbl-basic
```{r}
#| tbl-cap: Basic table
#| label: tbl-basic
table1(~island + bill_length_mm | species, penguins)
```

# Better labels
We can add better row labels (@tbl-labels).
```{r}
label(penguins$island) <- "Island"
label(penguins$bill_length_mm) <- "Bill Length (mm)"
```

```{r}
#| tbl-cap: Better labels table
#| label: tbl-labels
table1(~island + bill_length_mm | species, penguins)
```

Even better, we can use the `setLabel()` command in `mutate()` (@tbl-setlabel).

```{r}
penguins <- 
  penguins |> 
  mutate(
    flipper_length_mm = setLabel(
      flipper_length_mm, "Flipper Length (mm)"
    ),
    body_mass_g = setLabel(
      body_mass_g, "Body Mass (g)"
    ),
    sex = setLabel(sex, "Sex"),
    year = setLabel(year, "Year")
  )
```


```{r}
#| tbl-cap: setLabel example
#| label: tbl-setlabel
table1(~ flipper_length_mm + body_mass_g + sex + year | species, penguins)
```

# Changing stats
We can change the statistics used in the table. So over to geometric means and standard deviations (@tbl-geom).
```{r}
render_geometric <- c(
  "Geometric mean" = "GMEAN", 
  "Geometric SD" = "GSD"
)
```

```{r}
#| tbl-cap: Geometric means
#| label: tbl-geom
table1(
  x = ~ flipper_length_mm + body_mass_g + sex + year | species, 
  data = penguins, 
  render.continuous = render_geometric
)
```

To get the codes see here: 

- <https://benjaminrich.github.io/table1/vignettes/table1-examples.html#using-abbreviated-code-to-specify-a-custom-renderer>

or 

```{r}
names(stats.default(1:10))
names(stats.default(LETTERS[1:3])[[1]])
```

# Your own summary stats


```{r}
render_winsorized <- function(x, cutoff = .05, ...) {
  lo <- quantile(x, cutoff, na.rm = TRUE)
  hi <- quantile(x, 1 - cutoff, na.rm = TRUE)
  x[x < lo] <- lo
  x[x > hi] <- hi
  strs <- c(
    "",
    "Winsorized mean" = sprintf("%1.2f", mean(x, na.rm = TRUE)),
    "Winsorized SD" = sprintf("%1.2f", sd(x, na.rm = TRUE))
  )
  return(strs)
}
render_winsorized(1:10)
```


```{r}
table1(
  x = ~ flipper_length_mm + body_mass_g + sex | species, 
  data = penguins, 
  render.continuous = render_winsorized
)
```

# Column labels

